<div class="ask-ai-container">
  <h2 class="title">Ask AI</h2>
  <p class="subtitle">Got any questions, farm-related?</p>

  <div class="content-row">
    <!-- Upload Box -->
    <div class="upload-box" (click)="fileInput.click()">
      <ng-container *ngIf="previewUrl; else uploadIcon">
        <img [src]="previewUrl" class="preview-image" alt="Uploaded Image">
      </ng-container>

      <ng-template #uploadIcon>
        <img src="/upload.svg" class="upload-icon">
        <p class="upload-label">Upload an image</p>
      </ng-template>

      <input type="file" hidden #fileInput (change)="onFileSelected($event)">
    </div>

    <!-- Message Box -->
    <div class="message-box">
      <textarea [(ngModel)]="message" placeholder="Enter a message..."></textarea>
      <button class="send-btn" (click)="sendMessage()" [disabled]="loading">
        <span *ngIf="!loading">Send</span>
        <span *ngIf="loading">Sending...</span>
      </button>
    </div>
  </div>

  <!-- Conversation -->
  <div class="conversation">
    <div *ngFor="let chat of conversation" class="chat-message">
      <!-- User Message -->
      <div class="user-message">
        <p>{{ chat.userMessage }}</p>
        <img *ngIf="chat.userImage" [src]="chat.userImage" class="preview-image" alt="Uploaded Image">
      </div>

      <!-- AI Response -->
      <div class="ai-response">
        {{ chat.aiResponse }}
      </div>
    </div>
  </div>

  <!-- Footer -->
  <p class="footer-text">
    I'm stumped as a fence post until you ask something.
  </p>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <p class="loading-text">Analyzing your request...</p>
  </div>
</div>
